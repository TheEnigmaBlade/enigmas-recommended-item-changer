<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="create_jar" name="Create Jar for LoL Items">
	
	<!-- Set properties -->
	<property file="export.properties" />
	<tstamp>
		<format property="date" pattern="yyyy-MM-dd HH:mm:ss" />
	</tstamp>
	
	<property name="lollib" value="../LoL Lib/export/LolLib.jar" />
	<property name="launch4j_dir" value="C:\Program Files (x86)\launch4j" />
	
	<property name="jar_name" value="Enigma_Item_Changer" />
	<property name="dist_name" value="Enigma_Item_Changer" />
	<property name="dropbox_release" value="C:/Users/EnigmaBlade/Dropbox/Public/Software/EnigmaItem/release" />
	<property name="dropbox_update" value="C:/Users/EnigmaBlade/Dropbox/Public/Software/EnigmaItem/update" />
	
	<target name="check_ftp">
		<condition property="use_ftp">
			<equals arg1="${ftp.enabled}" arg2="true"/>
		</condition>
	</target>
	
	<!-- Create jar -->
	<target name="create_jar">
		<copy file="${lollib}" todir="lib" />
		
		<delete dir="export" />
		<mkdir dir="export" />
		<mkdir dir="export/jar" />
		
		<jar destfile="export/jar/${jar_name}.jar">
			<manifest>
				<attribute name="Built-By" value="Enigma" />
				<attribute name="Implementation-Version" value="${version}.${build}" />
				<attribute name="Built-Date" value="${date}" />
				<attribute name="Main-Class" value="net.enigmablade.lol.lolitem.EnigmaItemsMain" />
				<attribute name="SplashScreen-Image" value="resources/images/splash.png" />
			</manifest>
			<fileset dir="bin" excludes="net/enigmablade/lol/lolitem/test/**" />
			<zipfileset src="lib/LoLLib.jar" excludes="META-INF/**" />
			<zipfileset src="lib/sqlitejdbc.jar" excludes="META-INF/**" />
			<zipfileset src="lib/json-simple.jar" excludes="META-INF/**" />
		</jar>
		
		<jar destfile="export/jar/URL_Installer.jar">
			<manifest>
				<attribute name="Built-By" value="Enigma" />
				<attribute name="Implementation-Version" value="${installer_version}" />
				<attribute name="Built-Date" value="${date}" />
				<attribute name="Main-Class" value="enigma.lol.installer.BasicInstallerMain" />
			</manifest>
			<fileset dir="bin" includes="net/enigmablade/lol/installer/BasicInstallerMain.class,net/enigmablade/lol/installer/ProtocolInstaller.class,net/enigmablade/lol/installer/util/WinRegistry.class" />
		</jar>
		
	</target>
	
	<!-- Create native executables -->
	<target name="create_native">
		<!-- Create wrapper config -->
		<echoxml file="launch4j/launch4jconfig.xml">
			<launch4jConfig>
			  <dontWrapJar>false</dontWrapJar>
			  <headerType>gui</headerType>
			  <jar>..\export\jar\${jar_name}.jar</jar>
			  <outfile>..\export\Enigma Item Changer.exe</outfile>
			  <errTitle></errTitle>
			  <cmdLine>-debug</cmdLine>
			  <chdir></chdir>
			  <priority>normal</priority>
			  <downloadUrl>http://www.oracle.com/technetwork/java/javase/downloads/java-se-jre-7-download-432155.html</downloadUrl>
			  <supportUrl></supportUrl>
			  <customProcName>false</customProcName>
			  <stayAlive>false</stayAlive>
			  <manifest></manifest>
			  <icon>..\resource-dev\images\icon\icon.ico</icon>
			  <jre>
			    <path></path>
			    <minVersion>1.6.0</minVersion>
			    <maxVersion></maxVersion>
			    <jdkPreference>preferJre</jdkPreference>
			  </jre>
			  <versionInfo>
			    <fileVersion>${version}.${build}</fileVersion>
			    <txtFileVersion>${version}</txtFileVersion>
			    <fileDescription>Enigma&apos;s Recommended Item Changer</fileDescription>
			    <copyright>TheEnigmaBlade</copyright>
			    <productVersion>${version}.${build}</productVersion>
			    <txtProductVersion>${version}</txtProductVersion>
			    <productName>Enigma&apos;s Recommended Item Changer</productName>
			    <companyName>TheEnigmaBlade</companyName>
			    <internalName>Enigma Item Changer</internalName>
			    <originalFilename>Enigma Item Changer.exe</originalFilename>
			  </versionInfo>
			</launch4jConfig>
		</echoxml>
		
		<!-- Create wrapped exe -->
		<taskdef name="launch4j" classname="net.sf.launch4j.ant.Launch4jTask" classpath="${launch4j_dir}/launch4j.jar:${launch4j_dir}/lib/xstream.jar" />
		<launch4j configFile="launch4j/launch4jconfig.xml" />
	</target>
	
	<!-- Create distribution archives -->
	<target name="create_zip">
		<mkdir dir="export/dist" />
		
		<!-- Copy required files -->
		<copy file="license.txt" todir="export"	/>
		<copy file="changelog.txt" todir="export" />
		<copy file="cache.dat" todir="export" />
		<copy file="Updater.exe" todir="export" />
		
		<!-- Create archives -->
		<zip destfile="export/dist/${dist_name}_${version}.zip" basedir="export" excludes="jar/**,dist/**" />
		<zip destfile="export/dist/update_package.zip" basedir="export" excludes="jar/**,dist/**,license.txt" />
	</target>
	
	<!-- Copy distribution archives to dropbox -->
	<target name="distribute">
		<copy file="export/dist/${dist_name}_${version}.zip" todir="${dropbox_release}" />
	</target>
	
	<!-- Upload distribution archives to webserver -->
	<target name="distribute_ftp" depends="check_ftp" if="use_ftp">
		<ftp server="${ftp.server}" userid="${ftp.user}" password="${ftp.password}" remotedir="${ftp.dir}/downloads/lol-item-changer" binary="yes" verbose="true" passive="yes" >
			<fileset dir="export/dist/">
				<include name="${dist_name}_${version}.zip" />
			</fileset>
		</ftp>
	</target>
	
	<!-- Copy update archives and information to dropbox -->
	<target name="distribute_update">
		<echo file="export/dist/version.txt">${version}.${build}</echo>
		
		<copy file="export/dist/version.txt" todir="${dropbox_update}" />
		<copy file="export/dist/update_package.zip" todir="${dropbox_update}" />
		<copy file="changelog.txt" todir="${dropbox_release}" />
	</target>
	
	<!-- Upload update archives and information to webserver -->
	<target name="distribute_update_ftp" depends="check_ftp" if="use_ftp">
		<ftp server="${ftp.server}" userid="${ftp.user}" password="${ftp.password}" remotedir="${ftp.dir}/updates/EnigmaItem" binary="yes" verbose="true" passive="yes" >
			<fileset dir="export/dist/">
				<include name="update_package.zip" />
				<include name="changelog.txt" />
				<include name="version.txt" />
			</fileset>
		</ftp>
	</target>
	
	<!-- Create source distribution archive -->
	<target name="create_src_zip">
		<zip destfile="export/dist/${dist_name}_${version}_src.zip" basedir="." excludes="todo.txt,export/**,dev tools/**,resource-dev/**,Backgrounds/**,logs/**" />
	</target>
	
	<!-- Copy source distribution archive to dropbox -->
	<target name="distribute_src">
		<copy file="export/dist/${dist_name}_${version}_src.zip" todir="${dropbox_release}" />
	</target>
	
	<!-- Upload source distribution archive to webserver -->
	<target name="distribute_src_ftp" depends="check_ftp" if="use_ftp">
		<copy file="export/dist/${dist_name}_${version}_src.zip" todir="${dropbox_release}" />
	</target>
	
</project>
